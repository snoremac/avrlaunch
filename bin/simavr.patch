diff --git a/Makefile.common b/Makefile.common
index 0477af2..cfde0fb 100644
--- a/Makefile.common
+++ b/Makefile.common
@@ -46,13 +46,13 @@ CORE_CFLAGS	= -nostdinc -DAVR_CORE=1
 ifeq (${shell uname}, Darwin)
 # gcc 4.2 from MacOS is really not up to scratch anymore 
 CC			= clang
-AVR_ROOT 	:= "/Applications/Arduino.app/Contents/Resources/Java/hardware/tools/avr/"
-AVR_INC 	:= ${AVR_ROOT}/avr-4/
-AVR 		:= ${AVR_ROOT}/bin/avr-
+AVR_ROOT 	:= /usr/local/avr/avr
+AVR_INC 	:= ${AVR_ROOT}
+AVR 		:= avr-
 # Thats for MacPorts libelf
 ifeq (${shell test -d /opt/local && echo Exists}, Exists)
-IPATH		+= /opt/local/include
-LFLAGS		= -L/opt/local/lib/
+IPATH		+= /opt/local/include:/opt/local/include/libelf
+LFLAGS		= -L/opt/local/lib/ -L${AVR_ROOT}/lib
 endif
 else
 LINUX_AVR_ROOTS := /usr/lib/avr /usr/avr /opt/cross/avr/avr
diff --git a/simavr/Makefile b/simavr/Makefile
index 080651c..ec67204 100644
--- a/simavr/Makefile
+++ b/simavr/Makefile
@@ -41,7 +41,7 @@ sim_o 	:= ${patsubst sim/%.c, ${OBJ}/%.o, ${sim}}
 VPATH	= cores
 VPATH	+= sim
 
-IPATH	= sim
+IPATH	+= sim
 IPATH	+= .
 IPATH	+= ../../shared
     
@@ -186,7 +186,7 @@ sim_core_decl.h: sim_core_config.h $(cores) Makefile
 	for core in $$(grep -r avr_kind_t cores/|awk -F '[ :]' '{print $$1 "=" $$3;}') ; do \
 		file=$${core/=*}; global=$${core/*=}; \
 		upper=$${file/cores\/sim_}; upper=$${upper/.c}; \
-		upper=$$(echo $$upper|tr '[a-z]' '[A-Z]'); \
+		upper=$$(echo $$global|tr '[a-z]' '[A-Z]'); \
 		decl+="#if CONFIG_$$upper\nextern avr_kind_t $$global;\n#endif\n"; \
 		array+="#if CONFIG_$$upper\n\t&$$global,\n#endif\n"; \
 	done ; \
diff --git a/tests/atmega88_coroutine.c b/tests/atmega88_coroutine.c
index 559fcf8..a59aa7a 100644
--- a/tests/atmega88_coroutine.c
+++ b/tests/atmega88_coroutine.c
@@ -57,7 +57,7 @@ static inline void _set_stack(register void * stack)
 			"out __SP_H__, %B0" "\n\t"
 			"out __SREG__, r0" "\n\t"
 			"out __SP_L__, %A0" "\n\t"
-			: : "e" (stack) :
+			: : "e" (stack)
 	);
 }
 
